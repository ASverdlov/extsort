# Внешняя сортировка

## Предположения
1. Окончанием строчек является символ `\n`.

## Запуск
TODO

## Алгоритм
Сортировка больших файлов реализуется в несколько последовательных стадий:

### `1.distribute-stage`

На первоначальной стадии весь файл делится на `--jobs`
частей. Назовем их `workload`.

Части подбираются таким образом, чтобы они не слишком отличались
по размеру, и при этом каждая часть оканчивалась на конце какой-то строчки.

### `2.sort-stage`

Каждый workload (для каждого ядра) делится на куски (назовем их `chunk`-ами) размера `--chunksize`.
Каждый `chunk` загружается в память, отправляется на сортировку (обычную в памяти), и пишется обратно на диск.

В итоге имеем для каждого `workload` последовательные `chunk`-и, каждый из которых отсортирован.

### `3.merge-stage`

Стадия слияний отсортированных `chunk`-ов.
Обозначим `M` := `--merge-parallel`.

Процедура слияния для каждого `workload` (каждого ядра):
1. Берем первые `M` `chunk`-ов.
2. Создадим `M` указателями по каждому `chunk`-у.
3. Реализуем примитивный `M-way Merge`.
4. Передвигаемся к следующим `chunk`-ам. Повторяем (2) пока не дойдем до конца.

Если после исполнения процедуры слияния количество `chunk`-ов равно 1,
переходим к следующей стадии.

### `4.final-merge-stage`

После завершения одной или нескольких стадий `merge-stage` каждый `workload`
полностью отсортирован.

Остается сделать `merge-stage` по всем `workload`-ам.
